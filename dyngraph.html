<!DOCTYPE html>
<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
	<link rel="shortcut icon" type="image/jpg" href="img/favicon.ico"/>
        <title>Dynamic graph</title>
        <script src="js/main.js"></script>
        <script src="js/node.js"></script>
        <script src="js/graph.js"></script>
	<script type="text/javascript">
	  const canv_name = "c";
	  function config() {
	      check_tracer();
	      sel_fillcol.dispatchEvent(new Event("change"));
	      sel_outlicol.dispatchEvent(new Event("change"));
	      sel_linecol.dispatchEvent(new Event("change"));
	      sel_tracefill.dispatchEvent(new Event("change"));
	      sel_traceoutl.dispatchEvent(new Event("change"));
	      sel_traceline.dispatchEvent(new Event("change"));
	  }
	  function remove_unconnected() {
	      const edge_list = get_edge_list();
	      let output_string = "";
	      for(let i in edge_list) {
		  output_string += edge_list[i][0] + " " + edge_list[i][1] + "\n";
	      }
	      area_edgelist.value = output_string;
	  }
	  function set_scenario(scen,node_id="nu_nodes",edge_id="nu_edges",brch_id="nu_branches") {
	      //     nodes,  edges, branch
	      //       0       1      2
	      const scen_map = {
		  0: [true,  true,  false],
		  1: [true,  false, true ],
		  2: [true,  false, false],
		  3: [false, false, false]
	      };
	      const params = {
		  0: document.getElementById(node_id),
		  1: document.getElementById(edge_id),
		  2: document.getElementById(brch_id)
	      };
	      for( let a_key of Object.keys(params))
	       	  params[a_key].disabled = !scen_map[scen][a_key];
	  }
	  function proc_sel_graphalg(sel_id) {
	      const selg = document.getElementById(sel_id);
	      const seli = selg.selectedIndex;
	      switch (seli) {
	      case 0:
	      case 1:
		  set_scenario(0);
		  break;
	      case 2:
		  set_scenario(2);
		  break;
	      case 3:
		  set_scenario(1);
		  break;
	      case 4:
		  set_scenario(3);
		  break;
	      default:
		  console.log("Unhandled selection");
	      }
	      set_graph_alg(seli);
	  }
	</script>
	<style type="text/css">
	  body {
	      font-family: helvetica,arial,sans-serif;
	  }
	  h1 {
	      text-align: center;
	  }
	  input, button, label, select {
	      font-size: 1.8vw;
	      vertical-align: middle;
	  }
	  input.cb {
	      width: 2vw;
	      height: 2vh;
	  }
	  input.rb {
	      width: 2.5vw;
	      height: 2.5vh;
	  }
	  .float-container {
	      border: 3px solid #fff;
	      padding: 0px;
	  }
	  .float-canvas-child {
	      width: 55%;
	      float: left;
	      padding: 0px;
	      /* border: 2px solid red; */
	  }
	  .float-control-child {
	      width: 35%;
	      float: right;
	      padding: 2vw;
	      /* border: 2px solid red; */
	  }
	  .centred {
	      margin-left: auto;
	      margin-right: auto;
	      text-align: center;
	  }
	  .button1 {
	      width: 11rem;
	  }
	  .button2 {
	      width: 100%;
	  }
	  #canvas_space {}
	  #panel_space {}
	  body {
	      background: #27221F; /* 墨色 「すみいろ」*/
	      /* color: #EBF6F7;      /\* 藍白 「あいじろ」*\/ */
	      color: #FFDDCA;      /* 白練 「しろねり」*/
	  }
	  canvas {
	      background: #171412; /* 黒色 「こくしょく」*/
	      /* background: #181B26; /\* 褐色 「かちいろ」*\/ */
	      padding: 0;
	      margin: 0 auto;
	      margin-bottom: 1rem;
	      display: block;
	  }
	  td {
	      /* text-align: center; */
	      vertical-align: middle;
	  }
	</style>
    </head>

    <body onload="config();start();">
      <!-- <div class="float-container"> -->
        <div class="float-canvas-child" id="canvas_space"><canvas id="c" width="1000" height="1000"></canvas></div>
        <div class="float-control-child" id="panel_space">
	  <table>
	    <tr>
	      <td><label>nodes</label></td>
	      <td><input id="nu_nodes" type="number" value="100" min="2" max="1000"></input></td>
	    </tr>
	    <tr>
	      <td><label>size</label></td>
	      <td><input id="sz_nodes" type="number" value="5" min="1" max="100"></input></td>
	    </tr>
	    <tr>
	      <td><label>edges</label></td>
	      <td><input id="nu_edges" type="number" value="100" min="1" max="1000"></input></td>
	    </tr>
	    <tr>
	      <td><label>branches</label></td>
	      <td><input id="nu_branches" type="number" value="2" min="1" max="10" disabled></input></td>
	    </tr>
	    <tr>
	      <td><label>scatter</label></td>
	      <td><input id="nu_scatter" type="number" value="80" min="1" max="100" onchange="update_scatter('nu_scatter')"></input><label>%</label></td>
	    </tr>
	    <tr>
	      <td colspan="2">
		<table id="tbl_col_select">
		  <tr>
		    <th class="button1"></th>
		    <th>colour</th>
		    <th>random</th>
		    <th>off</th>
		  </tr>
		  <tr>
		    <td><label>fill</label></td>
		    <td class="centred"><input id="fill_col" type="color" value="#48929B"></input></td> <!-- 浅葱色「あさぎいろ」 -->
		    <td class="centred"><input id="cb_randfillcol" class="cb" type="checkbox" onchange="col_sel_change('cb_randfillcol','fill_col','rnd_fil_col')"></input></td>
		    <td class="centred"><input id="cb_fillcoloff" class="cb" type="checkbox" onchange="col_off_change('cb_fillcoloff','cb_randfillcol','fill_col','fill')"></input></td>
		  </tr>
		  <tr>
		    <td><label>outline</label></td>
		    <td class="centred"><input id="outli_col" type="color" value="#48929B"></input></td> <!-- 浅葱色「あさぎいろ」 -->
		    <td class="centred"><input id="cb_randoutlicol" class="cb" type="checkbox" onchange="col_sel_change('cb_randoutlicol','outli_col','rnd_oli_col')"></input></td>
		    <td class="centred"><input id="cb_outlicoloff" class="cb" type="checkbox" onchange="col_off_change('cb_outlicoloff','cb_randoutlicol','outli_col','outl')"></input></td>
		  </tr>
		  <tr>
		    <td><label>line</label></td>
		    <td class="centred"><input id="line_col" type="color" value="#86ABA5"></input></td> <!-- 水色「みずいろ」 -->
		    <td class="centred"><input id="cb_randlinecol" class="cb" type="checkbox" onchange="col_sel_change('cb_randlinecol','line_col','rnd_lin_col')"></input></td>
		    <td class="centred"><input id="cb_linecoloff" class="cb" type="checkbox" onchange="col_off_change('cb_linecoloff','cb_randlinecol','line_col','line')"></input></td>
		  </tr>
		  <tr>
		    <td><label>trace fill</label></td>
		    <td class="centred"><input id="trace_fill" type="color" value="#2B3736"></input></td> <!-- 鉄御納戸「てつおなんど」 -->
		    <td class="centred"><input id="cb_randtracecol" class="cb" type="checkbox" onchange="col_sel_change('cb_randtracecol','trace_fill','rnd_trc_fil')"></input></td>
		    <td class="centred"><input id="cb_tracecoloff" class="cb" type="checkbox" onchange="col_off_change('cb_tracecoloff','cb_randtracecol','trace_fill','tfil')" disabled></input></td>
		  </tr>
		  <tr>
		    <td><label>trace outline</label></td>
		    <td class="centred"><input id="trace_outline" type="color" value="#2B3736"></input></td> <!-- 鉄御納戸「てつおなんど」 -->
		    <td class="centred"><input id="cb_randtraceoutl" class="cb" type="checkbox" onchange="col_sel_change('cb_randtraceoutl','trace_outline','rnd_trc_oli')"></input></td>
		    <td class="centred"><input id="cb_traceoutloff" class="cb" type="checkbox" onchange="col_off_change('cb_traceoutloff','cb_randtraceoutl','trace_outline','toli')" disabled></input></td>
		  </tr>
		  <tr>
		    <td><label>trace line</label></td>
		    <td class="centred"><input id="trace_line" type="color" value="#344D56"></input></td> <!-- 熨斗目花色「のしめはないろ」 -->
		    <td class="centred"><input id="cb_randtraceline" class="cb" type="checkbox" onchange="col_sel_change('cb_randtraceline','trace_line','rnd_trc_lin')"></input></td>
		    <td class="centred"><input id="cb_tracefilloff" class="cb" type="checkbox" onchange="col_off_change('cb_tracefilloff','cb_randtraceline','trace_line','tlin')" disabled></input></td>
		  </tr>
		</table>
	      </td>
	    </tr>
	    <tr>
	      <td><label>tracing</label></td>
	      <td><input id="cb_tracing" class="cb" type="checkbox" checked></input></td>
	    </tr>
	    <tr>
	      <td><input type="button" class="button2" id="btn_print" onClick="print_edges(area_edgelist);" value="Print" /></td>
	      <td><input type="button" class="button2" id="btn_clear" onClick="clear_canvas();" value="Clear" /></td>
	    </tr>
	    <tr>
	      <td><input type="button" class="button1" id="btn_pause" onClick="pause();" value="Pause" /></td>
	      <td><input type="button" class="button1" id="btn_cont" onClick="go_on();" value="Continue" disabled></td>
	    </tr>
	    <tr>
	      <td><input type="button" class="button1" id="btn_start" onClick="start(canv_name,Number(inp_nodes.value),Number(inp_edges.value),Number(inp_branches.value));" value="Restart" /></td>
	      <td><input type="button" class="button1" id="btn_stop" onClick="stop();" value="Stop" /></td>
	    </tr>
	    <tr><td colspan="2" class="centred"><label>How to build graph?</label></td></tr>
	    <tr>
	      <td colspan="2"><select class="button2" id="sel_graphalgs" onchange="proc_sel_graphalg('sel_graphalgs')">
		  <option value="0" selected>Random:Random</option>
		  <option value="1">Serial:Random</option>
		  <option value="2">All:All</option>
		  <option value="3">Tree</option>
		  <option value="4">from Edge List</option>
	      </select></td>
	    </tr>
	    <tr>
	      <td colspan="2" class="centred"><textarea id="edge_list" rows="20" cols="41"></textarea>
	    </tr>
	    <tr>
	      <td colspan="2"><input type="button" class="button2" id="btn_rm_lone" onClick="remove_unconnected();" value="Remove Lone Nodes" /></td>
	    </tr>
	  </table>
	</div>
      <!-- </div> -->
      <script type="text/javascript">
	const tracer = document.getElementById("cb_tracing");
	tracer.addEventListener("change",function() { check_tracer(); });
	const nd_size = document.getElementById("sz_nodes");
	nd_size.addEventListener("change",function() {node_size = Number(nd_size.value)});
	const inp_nodes = document.getElementById("nu_nodes");
	const inp_edges = document.getElementById("nu_edges");
	const inp_branches = document.getElementById("nu_branches");
	const btn_start = document.getElementById("btn_start");
	const btn_stop = document.getElementById("btn_stop");
	const btn_pause = document.getElementById("btn_pause");
	const btn_cont = document.getElementById("btn_cont");
	const btn_print = document.getElementById("btn_print");
	const btn_clear = document.getElementById("btn_clear");
	const btn_rm_lone = document.getElementById("btn_rm_lone");
	const sel_fillcol = document.getElementById("fill_col");
	sel_fillcol.addEventListener("change",function() { colours["fill_colour"] = sel_fillcol.value; });
	const sel_linecol = document.getElementById("line_col");
	sel_linecol.addEventListener("change",function() { colours["line_colour"] = sel_linecol.value; });
	const sel_outlicol = document.getElementById("outli_col");
	sel_outlicol.addEventListener("change",function() { colours["outline_col"] = sel_outlicol.value; });
	const sel_tracefill = document.getElementById("trace_fill");
	sel_tracefill.addEventListener("change",function() { colours["trc_fil_col"] = sel_tracefill.value; });
	const sel_traceoutl = document.getElementById("trace_outline");
	sel_traceoutl.addEventListener("change",function() { colours["trc_oli_col"] = sel_traceoutl.value; });
	const sel_traceline = document.getElementById("trace_line");
	sel_traceline.addEventListener("change",function() { colours["trc_lin_col"] = sel_traceline.value; });
	const area_edgelist = document.getElementById("edge_list");
	area_edgelist.placeholder = "n1 n2\nn2 n3\nn3 n1";
	document.addEventListener('keydown', (event) => {
	    const keyName = event.key;
	    console.log(keyName);
	    if (event.ctrlKey && keyName == 'Enter')
		btn_start.dispatchEvent(new Event("click"));
	    if (keyName == 'Pause') {
		if (!btn_pause.disabled)
		    btn_pause.dispatchEvent(new Event("click"));
		else {
		    if (!btn_cont.disabled)
			btn_cont.dispatchEvent(new Event("click"));
		}
	    }
	    if (event.ctrlKey && event.altKey && event.key == 'c')
		btn_clear.dispatchEvent(new Event("click"));
	    if (event.ctrlKey && event.altKey &&  keyName == 'p')
		btn_print.dispatchEvent(new Event("click"));
	    if (event.ctrlKey && event.altKey && event.key == 'r')
		btn_rm_lone.dispatchEvent(new Event("click"));
	    if (event.ctrlKey && event.altKey && event.key == 't') {
		if(tracer.checked)
		    tracer.checked = false;
		else
		    tracer.checked = true;
		tracer.dispatchEvent(new Event("change"));
	    }
	}, false);
      </script>
    </body>
</html>
